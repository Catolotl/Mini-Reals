<script>
  const wrapper = document.getElementById('shortsWrapper');
  const shortsCount = wrapper.children.length;
  let currentIndex = 0;
  let isAnimating = false;

  // Utility function to get saved likes from localStorage
  function getLikedVideos() {
    return JSON.parse(localStorage.getItem('likedVideos') || '[]');
  }

  function saveLikedVideos(likedVideos) {
    localStorage.setItem('likedVideos', JSON.stringify(likedVideos));
  }

  // Apply saved likes on load
  document.querySelectorAll('.shorts-frame').forEach((frame, index) => {
    const title = frame.querySelector('.title-heart div').textContent;
    const button = frame.querySelector('.heart-button');
    const likedVideos = getLikedVideos();

    if (likedVideos.includes(title)) {
      button.classList.add('liked');
    }

    // Add click listener
    button.addEventListener('click', (e) => {
      e.stopPropagation(); // prevent triggering any navigation
      button.classList.toggle('liked');

      const liked = button.classList.contains('liked');
      let likedVideos = getLikedVideos();

      if (liked && !likedVideos.includes(title)) {
        likedVideos.push(title);
      } else if (!liked) {
        likedVideos = likedVideos.filter(t => t !== title);
      }

      saveLikedVideos(likedVideos);
    });
  });

  function swipeTo(index) {
    if (isAnimating) return;
    isAnimating = true;

    currentIndex = (index + shortsCount) % shortsCount;
    wrapper.style.transform = `translateY(-${currentIndex * 100}vh)`;

    setTimeout(() => isAnimating = false, 600);
  }

  function next() {
    swipeTo(currentIndex + 1);
  }

  function prev() {
    swipeTo(currentIndex - 1);
  }

  window.addEventListener('keydown', (e) => {
    if (e.code === 'ArrowDown' || e.code === 'Space') {
      e.preventDefault();
      next();
    } else if (e.code === 'ArrowUp') {
      e.preventDefault();
      prev();
    }
  });

  let scrollTimeout;
  window.addEventListener('wheel', (e) => {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      if (e.deltaY > 0) {
        next();
      } else if (e.deltaY < 0) {
        prev();
      }
    }, 100);
  });
</script>
